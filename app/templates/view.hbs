<section class="container">
  {{#if (or startDate endDate aggregateBy withinArea)}}
    {{search-params-breadcrumbs queryParamHash action=(action "returnToSearch")}}
  {{/if}}

  <div class="row d-flex">
    {{#if mappedDatasets}}
      <div class="col-12 mb-1">
        <div class="embed-responsive embed-responsive-{{if media.isMd "8by3" "4by3"}}">

          {{#leaflet-map class="embed-responsive-item"
                         zoomAnimation=(not disableAnimations)
                         fadeAnimation=(not disableAnimations)
                         markerZoomAnimation=(not disableAnimations)
                         bounds=mapBounds as |layers|}}
            {{layers.tile url="https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}{r}.png"}}
            {{#if mapSearchLimit}}
              {{layers.geojson geoJSON=mapSearchLimit className="map-search-boundary"}}
            {{/if}}
            {{layers.geojson geoJSON=model.primaryDataset.geoJSON
                             pointToLayer=mapGeoJSONPointToLayer
                             onEachFeature=createShapePopup
                             className=(concat
                               model.primaryDataset.type
                               " "
                               "dataset-color-0"
                             )}}
          {{/leaflet-map}}
        </div>
      </div>
    {{/if}}

    <div class="col-12 flex-first flex-lg-unordered">
      <h1>{{model.primaryDataset.humanName}}</h1>
    </div>

    <div class="col-12 col-lg-5 flex-last flex-lg-unordered">
      {{#if (or aggregateBy startDate endDate withinArea)}}
        <dl class="row no-gutters mb-0">

          {{#if isEventDataset}}
            <dt class="col-sm-6">{{fa-icon "calendar-o" class="text-muted" fixedWidth=true}} Dates Shown</dt>
            <dd class="col-sm-6 text-right">{{format-date startDate endDate}}</dd>
          {{/if}}

          {{#if (and isShapeDataset (gte model.primaryDataset.totalCount ENV.data.maxShapeItemsToDisplay))}}
            <div class="col-12">
              <div class="alert alert-warning small" role="alert">
                This dataset is too large to display in your browser. You can still download it to work offline.
              </div>
            </div>
          {{/if}}

          {{#if (gte model.primaryDataset.totalCount 1)}}
            <dt class="col-sm-6">
              {{fa-icon "hashtag" class="text-muted" fixedWidth=true}}
              Matching {{capitalize (concat model.primaryDataset.type "s")}}
            </dt>
            <dd class="col-sm-6 text-right">{{model.primaryDataset.totalCount}}</dd>
          {{/if}}

          {{#if (gte model.primaryDataset.totalCount 1)}}
            <dt class="col-sm-7">
              {{fa-icon "download" class="text-muted" fixedWidth=true}}
              Download
              <small class="text-muted"> (Matched Items)</small>
            </dt>
            <dd class="col-sm-5 text-right">
              {{download-menu model.primaryDataset filterDownload=true queryParams=queryParamHash}}
            </dd>
          {{/if}}

        </dl>
        <hr class="my-2">
      {{/if}}

      <dl class="row no-gutters">

        <dt class="col-sm-6">Data Provider</dt>
        <dd class="col-sm-6 text-right">{{model.primaryDataset.provider}}</dd>

        <dt class="col-sm-6">Date Added</dt>
        <dd class="col-sm-6 text-right">{{format-date model.primaryDataset.dateAdded}}</dd>

        {{#if isEventDataset}}
          <dt class="col-sm-6">Oldest Item</dt>
          <dd class="col-sm-6 text-right">{{format-date model.primaryDataset.oldest}}</dd>

          <dt class="col-sm-6">Newest Item</dt>
          <dd class="col-sm-6 text-right">{{format-date model.primaryDataset.newest}}</dd>
        {{/if}}

        <dt class="col-sm-6">Update Frequency</dt>
        <dd class="col-sm-6 text-right">{{model.primaryDataset.updateFreq}}</dd>

        <dt class="col-sm-6">Last Updated</dt>
        <dd class="col-sm-6 text-right">{{format-date model.primaryDataset.lastUpdate format="l LT"}}</dd>

        {{#if plottedDatasets}}
          <dt class="col-sm-12">Description</dt>
          <dd class="col-sm-12 text-justify small" style="max-height: 5rem; overflow-y: scroll;">
            {{model.primaryDataset.description}}
          </dd>
        {{/if}}

        <dt class="col-sm-6">Bulk Download <small class="text-muted">(All Data)</small></dt>
        <dd class="col-sm-6 text-right">
          {{download-menu model.primaryDataset direction="up" filterDownload=false}}
        </dd>

      </dl>

    </div>

    {{#if plottedDatasets}}
      <div class="col-12 col-lg-7">
        <div class="embed-responsive embed-responsive-{{if media.isLg "4by3" "8by3"}}">
          {{high-charts class="embed-responsive-item"
                        content=chartData
                        chartOptions=chartOptions}}
        </div>
      </div>
    {{/if}}
    {{#unless plottedDatasets}}
      <div class="col-12 col-lg-7 flex-last flex-lg-unordered">
        <dl class="row">
          <dt class="col-sm-12">Description</dt>
          <dd class="col-sm-12 text-justify small" style="max-height: 7.5rem; overflow-y: scroll;">
            {{model.primaryDataset.description}}
          </dd>
        </dl>
      </div>
    {{/unless}}
  </div>
</section>
